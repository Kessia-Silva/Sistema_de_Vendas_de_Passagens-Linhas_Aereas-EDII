<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> ChatBot </title>
    <link rel="icon" href="static\img\IconAviao.ico" type="image/x-icon">
    <link rel="stylesheet" href="static/css/chat_bot.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<style>
    .back-btn {
    position: absolute;
    top: 15px;
    left: 15px;
    padding: 10px 14px;
    background: #007bff;
    color: white;
    text-decoration: none;
    border-radius: 8px;
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 6px;
    transition: 0.3s;
}

.back-btn:hover {
    background: #0056b3;
}

</style>
<body>
  <!-- From Uiverse.io by ahmed150up --> 
  <div class="card">
    <div class="chat-header">Chat</div>
      <div class="chat-window">
        <ul class="message-list"></ul>
      </div>
      <div class="chat-input">
          <input type="text" class="message-input" placeholder="Pergunte alguma coisa">
          <button class="send-button">Send</button>
      </div>
    </div>

    <!-- Botão de voltar -->
  <a href="{{ url_for('voltar_chat') }}" class="back-btn">
      <i class="fas fa-arrow-left"></i> Voltar
  </a>


<script>
const messageInput = document.querySelector(".message-input");
const sendButton = document.querySelector(".send-button");
const messageList = document.querySelector(".message-list");

// Função para adicionar mensagens na tela
function addMessage(text, sender) {
    const li = document.createElement("li");
    li.textContent = text;
    li.className = sender; // "user" ou "bot"
    messageList.appendChild(li);
    messageList.scrollTop = messageList.scrollHeight;
}

// Função para mostrar "digitando..." com três pontos animados
function showTypingIndicator() {
    const li = document.createElement("li");
    li.className = "bot typing";
    messageList.appendChild(li);

    let dots = "";
    let count = 0;

    const interval = setInterval(() => {
        dots = ".".repeat((count % 3) + 1);
        li.textContent = "Digitando" + dots;
        messageList.scrollTop = messageList.scrollHeight;
        count++;
    }, 300); // troca os pontos a cada 300ms

    return { element: li, interval: interval };
}

// Enviar mensagem para o Flask
async function sendMessage() {
    const msg = messageInput.value.trim();
    if (!msg) return;

    addMessage(msg, "user");
    messageInput.value = "";

    // Mostra o indicador de digitação
    const typing = showTypingIndicator();

    try {
        const response = await fetch("/chat", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({message: msg})
        });
        const data = await response.json();

        // Mantém o "digitando..." por 1 segundo
        setTimeout(() => {
            clearInterval(typing.interval);
            typing.element.remove();
            addMessage(data.reply, "bot");
        }, 1000); // 1 segundo de animação
    } catch (error) {
        clearInterval(typing.interval);
        typing.element.remove();
        addMessage("Erro ao conectar com o servidor.", "bot");
    }
}

// Eventos de envio
sendButton.addEventListener("click", sendMessage);
messageInput.addEventListener("keypress", function(e) {
    if (e.key === "Enter") sendMessage();
});
</script>
  
</body>

</html>